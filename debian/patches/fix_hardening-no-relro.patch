Description: Do not override and ensure use of CFLAGS and LDFLAGS
Author: Iain R. Learmonth <irl@fsfe.org>
Last-Update: 2014-09-08

--- direwolf.orig/Makefile.linux
+++ direwolf/Makefile.linux
@@ -84,9 +84,9 @@
 # You might see improvement with -march fine tuned to your hardware.
 # Probably should keep pentium3 if you will be redistributing binaries
 # to other people.
-CFLAGS := -O3 -march=pentium3 -pthread -Iutm
+CFLAGS := -O3 -march=pentium3 -pthread -Iutm $(CPPFLAGS)
 else
-CFLAGS := -O3 -pthread -Iutm
+CFLAGS := -O3 -pthread -Iutm $(CPPFLAGS)
 endif
 
 
@@ -121,7 +121,7 @@
 		ptt.o beacon.o dwgps.o encode_aprs.o latlong.o encode_aprs.o latlong.o textcolor.o \
 		dtmf.o aprs_tt.o tt_user.o tt_text.o igate.o nmea.o log.o telemetry.o \
 		utm.a
-	$(CC) $(CFLAGS) -o $@ $^ -lpthread -lrt $(LDLIBS) -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lpthread -lrt $(LDLIBS) -lm
 
 
 # Optimization for slow processors.
@@ -132,7 +132,7 @@
 
 
 fsk_fast_filter.h : demod_afsk.c
-	$(CC) $(CFLAGS) -o gen_fff -DGEN_FFF demod_afsk.c dsp.c textcolor.c -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o gen_fff -DGEN_FFF demod_afsk.c dsp.c textcolor.c -lm
 	./gen_fff > fsk_fast_filter.h
 
 
@@ -141,7 +141,7 @@
 	ar -cr $@ $^
 
 LatLong-UTMconversion.o : utm/LatLong-UTMconversion.c
-	$(CC) $(CFLAGS) -c -o $@ $^
+	$(CC) $(CFLAGS) $(LDFLAGS) -c -o $@ $^
 
 
 # Optional installation into /usr/...
@@ -193,38 +193,38 @@
 # Separate application to decode raw data.
 
 decode_aprs : decode_aprs.c symbols.c ax25_pad.c textcolor.c fcs_calc.c latlong.c log.c telemetry.o
-	$(CC) $(CFLAGS) -o decode_aprs -DTEST $^ -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o decode_aprs -DTEST $^ -lm
 
 
 
 # Convert between text and touch tone representation.
 
 text2tt : tt_text.c
-	$(CC) $(CFLAGS) -DENC_MAIN -o text2tt tt_text.c
+	$(CC) $(CFLAGS) $(LDFLAGS) -DENC_MAIN -o text2tt tt_text.c
 
 tt2text : tt_text.c
-	$(CC) $(CFLAGS) -DDEC_MAIN -o tt2text tt_text.c
+	$(CC) $(CFLAGS) $(LDFLAGS) -DDEC_MAIN -o tt2text tt_text.c
 
 
 # Convert between Latitude/Longitude and UTM coordinates.
 
 ll2utm : ll2utm.c utm.a
-	$(CC) $(CFLAGS) -o $@ $^ -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lm
 
 utm2ll : utm2ll.c utm.a
-	$(CC) $(CFLAGS) -o $@ $^ -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lm
 
 
 # Convert from log file to GPX.
 
 log2gpx : log2gpx.c 
-	$(CC) $(CFLAGS) -o $@ $^ -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lm
 
 
 # Test application to generate sound.
 
 gen_packets : gen_packets.c ax25_pad.c hdlc_send.c fcs_calc.c gen_tone.c textcolor.c 
-	$(CC) $(CFLAGS) -o $@ $^ $(LDLIBS) -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ $(LDLIBS) -lm
 
 demod.o : tune.h
 demod_afsk.o : tune.h
@@ -232,7 +232,7 @@
 
 testagc : atest.c demod.c dsp.c demod_afsk.c demod_9600.c hdlc_rec.c hdlc_rec2.o multi_modem.o rrbb.o \
 		fcs_calc.c ax25_pad.c decode_aprs.c telemetry.c latlong.c symbols.c tune.h textcolor.c
-	$(CC) $(CFLAGS) -o atest $^ -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o atest $^ -lm
 	./atest 02_Track_2.wav | grep "packets decoded in" > atest.out
 
 
@@ -241,14 +241,14 @@
 
 atest : atest.c demod.c dsp.c demod_afsk.c demod_9600.c hdlc_rec.c hdlc_rec2.o multi_modem.o rrbb.o \
 		fcs_calc.c ax25_pad.c decode_aprs.c telemetry.c latlong.c symbols.c textcolor.c
-	$(CC) $(CFLAGS) -o $@ $^ -lm -lrt
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lm -lrt
 	time ./atest ../direwolf-0.2/02_Track_2.wav 
 
 # Unit test for inner digipeater algorithm
 
 
 dtest : digipeater.c ax25_pad.c dedupe.c fcs_calc.c tq.c textcolor.c
-	$(CC) $(CFLAGS) -DTEST -o $@ $^
+	$(CC) $(CFLAGS) $(LDFLAGS) -DTEST -o $@ $^
 	./dtest
 
 
@@ -256,14 +256,14 @@
 
 
 itest : igate.c textcolor.c ax25_pad.c fcs_calc.c 
-	$(CC) $(CFLAGS) -DITEST -o $@ $^
+	$(CC) $(CFLAGS) $(LDFLAGS) -DITEST -o $@ $^
 	./itest
 
 
 # Unit test for UDP reception with AFSK demodulator
 
 udptest : udp_test.c demod.c dsp.c demod_afsk.c demod_9600.c hdlc_rec.c hdlc_rec2.c multi_modem.c rrbb.c fcs_calc.c ax25_pad.c decode_aprs.c symbols.c textcolor.c
-	$(CC) $(CFLAGS) -o $@ $^ -lm -lrt
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lm -lrt
 	./udptest
 
 
@@ -271,14 +271,14 @@
 
 
 etest : telemetry.c ax25_pad.c fcs_calc.c textcolor.c misc.a regex.a
-	$(CC) $(CFLAGS) -o $@ $^ -lm -lrt
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lm -lrt
 	./etest
 	
 
 # Multiple AGWPE network or serial port clients to test TNCs side by side.
 
 aclients : aclients.c ax25_pad.c fcs_calc.c textcolor.c
-	$(CC) $(CFLAGS) -g -o $@ $^ 
+	$(CC) $(CFLAGS) $(LDFLAGS) -g -o $@ $^ 
 
 
 SRCS = direwolf.c demod.c dsp.c demod_afsk.c demod_9600.c hdlc_rec.c multi_modem.c fcs_calc.c ax25_pad.c decode_aprs.c symbols.c \
